# 【第三期】21 天打卡行动

#21 天打卡# Day28
专栏：kafka 核心技术与实战
时间：2020-03-21
学习：09
学习要点和总结：

一、[09 | 生产者消息分区机制原理剖析](https://time.geekbang.org/column/article/102067)

1. Kafka 有主题（Topic）的概念，它是承载真实数据的逻辑容器，而在主题之下还分为若干个分区。Kafka 的消息组织方式实际上是三级结构，主题-分区-消息。主题下的每条消息只会保存在某一个分区中，而不会在多个分区中被保存多份。

2. 分区的作用就是提供负载均衡的能力，或者说对数据进行分区的主要原因，就是为了实现系统的高伸缩性（Scalability）。不同的分区能够被放置到不同节点的机器上，而数据的读写操作也都是针对分区这个粒度而进行的，这样每个节点的机器都能独立地执行各自分区的读写请求处理。并且，我们还可以通过添加新的节点机器来增加整体系统的吞吐量。
3. 分区策略是决定生产者将消息发送到哪个分区的算法。
4. 轮询策略：Round-robin 策略，即顺序分配。轮询策略是 Kafka Java 生产者 API 默认提供的分区策略。如果你未指定 partitioner.class 参数，那么你的生产者程序会按照轮询的方式在主题的所有分区间均匀地"码放"消息。
5. 轮询策略有非常优秀的负载均衡表现，它总是能保证消息最大限度地被平均分配到所有分区上，故默认情况下它是最合理的分区策略，也是我们最常用的分区策略之一。随机策略
6. 随机策略也称 Randomness 策略。所谓随机就是我们随意地将消息放置到任意一个分区上。
7. 按消息键保序策略也称 Key-ordering 策略。Kafka 允许为每条消息定义消息键，简称为 Key。一旦消息被定义了 Key，那么你就可以保证同一个 Key 的所有消息都进入到相同的分区里面。
8. 还有一种比较常见的，即所谓的基于地理位置的分区策略。当然这种策略一般只针对那些大规模的 Kafka 集群，特别是跨城市、跨国家甚至是跨大洲的集群。
